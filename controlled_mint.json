{
  "contractName": "ControlledMint",
  "constructorInputs": [
    {
      "name": "tokenAssetId_txid",
      "type": "bytes32"
    },
    {
      "name": "tokenAssetId_gidx",
      "type": "int"
    },
    {
      "name": "ctrlAssetId_txid",
      "type": "bytes32"
    },
    {
      "name": "ctrlAssetId_gidx",
      "type": "int"
    },
    {
      "name": "issuerPk",
      "type": "pubkey"
    }
  ],
  "functions": [
    {
      "name": "mint",
      "functionInputs": [
        {
          "name": "amount",
          "type": "int"
        },
        {
          "name": "recipientPk",
          "type": "pubkey"
        },
        {
          "name": "issuerSig",
          "type": "signature"
        }
      ],
      "serverVariant": true,
      "require": [
        {
          "type": "groupCheck"
        },
        {
          "type": "groupCheck"
        },
        {
          "type": "groupCheck"
        },
        {
          "type": "assetCheck"
        },
        {
          "type": "comparison"
        },
        {
          "type": "signature"
        },
        {
          "type": "serverSignature"
        }
      ],
      "asm": [
        "<tokenAssetId_txid>",
        "<tokenAssetId_gidx>",
        "OP_FINDASSETGROUPBYASSETID",
        "<tokenGroup>",
        "OP_1",
        "OP_INSPECTASSETGROUPSUM",
        "<tokenGroup>",
        "OP_0",
        "OP_INSPECTASSETGROUPSUM",
        "OP_SUB64",
        "OP_VERIFY",
        "<amount>",
        "OP_EQUAL",
        "<tokenGroup>",
        "OP_INSPECTASSETGROUPCTRL",
        "<ctrlAssetId>",
        "OP_EQUAL",
        "<ctrlAssetId_txid>",
        "<ctrlAssetId_gidx>",
        "OP_FINDASSETGROUPBYASSETID",
        "<ctrlGroup>",
        "OP_1",
        "OP_INSPECTASSETGROUPSUM",
        "<ctrlGroup>",
        "OP_0",
        "OP_INSPECTASSETGROUPSUM",
        "OP_SUB64",
        "OP_VERIFY",
        "0",
        "OP_EQUAL",
        "0",
        "<tokenAssetId_txid>",
        "<tokenAssetId_gidx>",
        "OP_INSPECTOUTASSETLOOKUP",
        "OP_DUP",
        "OP_1NEGATE",
        "OP_EQUAL",
        "OP_NOT",
        "OP_VERIFY",
        "<amount>",
        "OP_GREATERTHANOREQUAL64",
        "OP_VERIFY",
        "0",
        "OP_INSPECTOUTPUTSCRIPTPUBKEY",
        "<new SingleSig(recipientPk)>",
        "OP_EQUAL",
        "<issuerPk>",
        "<issuerSig>",
        "OP_CHECKSIG",
        "<SERVER_KEY>",
        "<serverSig>",
        "OP_CHECKSIG"
      ]
    },
    {
      "name": "mint",
      "functionInputs": [
        {
          "name": "amount",
          "type": "int"
        },
        {
          "name": "recipientPk",
          "type": "pubkey"
        },
        {
          "name": "issuerSig",
          "type": "signature"
        },
        {
          "name": "issuerPkSig",
          "type": "signature"
        },
        {
          "name": "recipientPkSig",
          "type": "signature"
        }
      ],
      "serverVariant": false,
      "require": [
        {
          "type": "nOfNMultisig",
          "message": "2-of-2 signatures required (introspection fallback)"
        },
        {
          "type": "older",
          "message": "Exit timelock of 288 blocks"
        }
      ],
      "asm": [
        "<issuerPk>",
        "<issuerPkSig>",
        "OP_CHECKSIGVERIFY",
        "<recipientPk>",
        "<recipientPkSig>",
        "OP_CHECKSIG",
        "288",
        "OP_CHECKSEQUENCEVERIFY",
        "OP_DROP"
      ]
    },
    {
      "name": "burn",
      "functionInputs": [
        {
          "name": "amount",
          "type": "int"
        },
        {
          "name": "ownerSig",
          "type": "signature"
        },
        {
          "name": "ownerPk",
          "type": "pubkey"
        }
      ],
      "serverVariant": true,
      "require": [
        {
          "type": "groupCheck"
        },
        {
          "type": "signature"
        },
        {
          "type": "serverSignature"
        }
      ],
      "asm": [
        "<tokenAssetId_txid>",
        "<tokenAssetId_gidx>",
        "OP_FINDASSETGROUPBYASSETID",
        "<tokenGroup>",
        "OP_0",
        "OP_INSPECTASSETGROUPSUM",
        "<tokenGroup>",
        "OP_1",
        "OP_INSPECTASSETGROUPSUM",
        "<amount>",
        "OP_SCRIPTNUMTOLE64",
        "OP_ADD64",
        "OP_VERIFY",
        "OP_GREATERTHANOREQUAL",
        "<ownerPk>",
        "<ownerSig>",
        "OP_CHECKSIG",
        "<SERVER_KEY>",
        "<serverSig>",
        "OP_CHECKSIG"
      ]
    },
    {
      "name": "burn",
      "functionInputs": [
        {
          "name": "amount",
          "type": "int"
        },
        {
          "name": "ownerSig",
          "type": "signature"
        },
        {
          "name": "ownerPk",
          "type": "pubkey"
        },
        {
          "name": "issuerPkSig",
          "type": "signature"
        },
        {
          "name": "ownerPkSig",
          "type": "signature"
        }
      ],
      "serverVariant": false,
      "require": [
        {
          "type": "nOfNMultisig",
          "message": "2-of-2 signatures required (introspection fallback)"
        },
        {
          "type": "older",
          "message": "Exit timelock of 288 blocks"
        }
      ],
      "asm": [
        "<issuerPk>",
        "<issuerPkSig>",
        "OP_CHECKSIGVERIFY",
        "<ownerPk>",
        "<ownerPkSig>",
        "OP_CHECKSIG",
        "288",
        "OP_CHECKSEQUENCEVERIFY",
        "OP_DROP"
      ]
    },
    {
      "name": "lockSupply",
      "functionInputs": [
        {
          "name": "issuerSig",
          "type": "signature"
        }
      ],
      "serverVariant": true,
      "require": [
        {
          "type": "groupCheck"
        },
        {
          "type": "signature"
        },
        {
          "type": "serverSignature"
        }
      ],
      "asm": [
        "<ctrlAssetId_txid>",
        "<ctrlAssetId_gidx>",
        "OP_FINDASSETGROUPBYASSETID",
        "<ctrlGroup>",
        "OP_1",
        "OP_INSPECTASSETGROUPSUM",
        "0",
        "OP_EQUAL",
        "<issuerPk>",
        "<issuerSig>",
        "OP_CHECKSIG",
        "<SERVER_KEY>",
        "<serverSig>",
        "OP_CHECKSIG"
      ]
    },
    {
      "name": "lockSupply",
      "functionInputs": [
        {
          "name": "issuerSig",
          "type": "signature"
        },
        {
          "name": "issuerPkSig",
          "type": "signature"
        }
      ],
      "serverVariant": false,
      "require": [
        {
          "type": "nOfNMultisig",
          "message": "1-of-1 signatures required (introspection fallback)"
        },
        {
          "type": "older",
          "message": "Exit timelock of 288 blocks"
        }
      ],
      "asm": [
        "<issuerPk>",
        "<issuerPkSig>",
        "OP_CHECKSIG",
        "288",
        "OP_CHECKSEQUENCEVERIFY",
        "OP_DROP"
      ]
    }
  ],
  "source": "// Controlled Mint Contract\n// Demonstrates asset group introspection primitives\n//\n// This contract manages a token minting authority where:\n// 1. mint() - Authority can mint new tokens (delta > 0), control asset required\n// 2. burn() - Anyone can burn tokens (delta < 0), no control needed\n// 3. lockSupply() - Authority burns the control asset to lock supply forever\n//\n// Asset groups provide aggregate views of asset flows across all inputs/outputs,\n// enabling balance verification without iterating individual UTXOs.\n\noptions {\n  server = serverPk;\n  exit = 288;\n}\n\ncontract ControlledMint(\n  bytes32 tokenAssetId,\n  bytes32 ctrlAssetId,\n  pubkey issuerPk\n) {\n  // Mint: delta > 0, control asset present and retained\n  function mint(int amount, pubkey recipientPk, signature issuerSig) {\n    let tokenGroup = tx.assetGroups.find(tokenAssetId);\n    require(tokenGroup.delta == amount, \"delta mismatch\");\n    require(tokenGroup.control == ctrlAssetId, \"wrong control\");\n\n    let ctrlGroup = tx.assetGroups.find(ctrlAssetId);\n    require(ctrlGroup.delta == 0, \"ctrl supply changed\");\n\n    require(tx.outputs[0].assets.lookup(tokenAssetId) >= amount, \"mint short\");\n    require(tx.outputs[0].scriptPubKey == new SingleSig(recipientPk), \"wrong dest\");\n    require(checkSig(issuerSig, issuerPk), \"bad sig\");\n  }\n\n  // Burn: delta < 0, no control asset needed\n  function burn(int amount, signature ownerSig, pubkey ownerPk) {\n    let tokenGroup = tx.assetGroups.find(tokenAssetId);\n    require(tokenGroup.sumInputs >= tokenGroup.sumOutputs + amount, \"burn short\");\n    require(checkSig(ownerSig, ownerPk), \"bad sig\");\n  }\n\n  // Lock supply forever: burn the control asset\n  function lockSupply(signature issuerSig) {\n    let ctrlGroup = tx.assetGroups.find(ctrlAssetId);\n    require(ctrlGroup.sumOutputs == 0, \"ctrl not burned\");\n    require(checkSig(issuerSig, issuerPk), \"bad sig\");\n  }\n}\n",
  "compiler": {
    "name": "arkade-compiler",
    "version": "0.1.0"
  },
  "updatedAt": "2026-02-10T22:23:28.088196+00:00"
}